<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Reactor Designer (webgl)</title>

        <link rel="stylesheet" href="https://code.jquery.com/ui/1.11.4/themes/ui-darkness/jquery-ui.css">
        <link href="css/reactor.css" rel="stylesheet">


        <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
        <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>

        <script src="js/structures.js"></script>
        <script src="js/ui.js"></script>

        <script src="js/my_webgl.js"></script>
        <script>
            "use strict";

            $(function() {

                var array = new Float32Array(512*512*4);

                for(var i = 0; i < 512*512*4; i++){
                    array[i] = Math.random();
                }

                // Get A WebGL context

                var my = WebGL.make("canvas");


                var program = my.linkProgram({
                    vertexShaderSource : document.getElementById("2d-vertex-shader").text,
                    fragmentShaderSource : document.getElementById("2d-fragment-shader").text
                });


                // set the resolution
                program.addUniformFloat("u_resolution", [canvas.width, canvas.height]);

                my.addArrayFloat([
                    [0, 0],
                    [400, 0],
                    [0, 200],
                    [0, 200],
                    [400, 0],
                    [400, 200]
                ]).bindToAttribute(program, "a_position");

                my.enableFloatTexture();
                my.addTextureArray(512, 512, array, true).bindToTextureUnit(program, 0, "u_image_A");
                my.addTextureArray(512, 512, array, true).bindToTextureUnit(program, 0, "u_image_B");

                my.addArrayFloat([
                    [0.0,  0.0],
                    [1.0,  0.0],
                    [0.0,  1.0],
                    [0.0,  1.0],
                    [1.0,  0.0],
                    [1.0,  1.0]
                ]).bindToAttribute(program, "a_texCoord");

                // draw
                program.drawTriangles(0, 6);


            });
        </script>


        <script id="2d-vertex-shader" type="x-shader/x-vertex">
            attribute vec2 a_position;
            attribute vec2 a_texCoord;

            uniform vec2 u_resolution;

            varying vec2 v_texCoord;

            void main() {
               // convert the rectangle from pixels to 0.0 to 1.0
               vec2 zeroToOne = a_position / u_resolution;

               // convert from 0->1 to 0->2
               vec2 zeroToTwo = zeroToOne * 2.0;

               // convert from 0->2 to -1->+1 (clipspace)
               vec2 clipSpace = zeroToTwo - 1.0;

               gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);

               v_texCoord = a_texCoord;
            }
        </script>

        <script id="2d-fragment-shader" type="x-shader/x-fragment">
            precision mediump float;

            // our texture
            uniform sampler2D u_image_A;
            uniform sampler2D u_image_B;
            //uniform vec2 u_textureSize;

            // the texCoords passed in from the vertex shader.
            varying vec2 v_texCoord;

            void main() {

               gl_FragColor = texture2D(u_image_A, v_texCoord) - 0.5*texture2D(u_image_B, v_texCoord);
            }
        </script>

    </head>
    <body>
        <canvas id="canvas" width="400" height="300"></canvas>

    </body>
</html>
